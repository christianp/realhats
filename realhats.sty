\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{realhats}[2018-02-02 realhats]

\RequirePackage{amsmath}
\RequirePackage{tikz}
\RequirePackage{graphicx}
\RequirePackage{ifthen}
\RequirePackage[first=0, last=4]{lcg}
\RequirePackage{calc}

\newcommand\myhat{}
\newlength{\xx}
\newlength{\wid}
\newlength{\hei}

\renewcommand{\vec}[1]{\mathbf#1}
\renewcommand{\hat}[1]{\rand\hatn{#1}{\arabic{rand}}}

\newcommand{\hatn}[2]{%
\settowidth{\wid}{$#1$}
\setlength{\hei}{0mm}
\setlength{\xx}{1pt}
\ifthenelse{\equal{#2}{0}}{\renewcommand\myhat{hats/beret}\addtolength{\hei}{-2pt}}{}%
\ifthenelse{\equal{#2}{1}}{\renewcommand\myhat{hats/santa}}{}%
\ifthenelse{\equal{#2}{2}}{\renewcommand\myhat{hats/scottish}\addtolength{\hei}{-2pt}}{}%
\ifthenelse{\equal{#2}{3}}{\renewcommand\myhat{hats/sombrero}\addtolength{\xx}{-1pt}}{}%
\ifthenelse{\equal{#2}{4}}{\renewcommand\myhat{hats/witch}\addtolength{\xx}{-1pt}}{}%
%
\ifthenelse{\equal{#1}{\vec{b}}}{\addtolength{\xx}{-1pt}\addtolength{\hei}{2pt}}{}%
\ifthenelse{\equal{#1}{\vec{d}}}{\addtolength{\xx}{1pt}\addtolength{\hei}{2pt}}{}%
\ifthenelse{\equal{#1}{\vec{f}}}{\addtolength{\hei}{2pt}}{}%
\ifthenelse{\equal{#1}{\vec{h}}}{\addtolength{\xx}{-1pt}\addtolength{\hei}{2pt}}{}%
\ifthenelse{\equal{#1}{\vec{k}}}{\addtolength{\xx}{-1pt}\addtolength{\hei}{2pt}}{}%
\ifthenelse{\equal{#1}{\vec{t}}}{\addtolength{\hei}{2pt}}{}%
\ifthenelse{\equal{#1}{\vec{l}}}{\addtolength{\hei}{2pt}}{}%
#1%
\begin{tikzpicture}[overlay,x=1cm,y=1cm]
\clip (-1,0) rectangle (1,1);
\node[anchor=south] at (\xx-\wid/2,\hei) {\includegraphics[width=3mm]{\myhat}};
\end{tikzpicture}}

